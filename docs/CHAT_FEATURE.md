# 💬 AI 对话功能

## 概述

新增了完整的 AI 对话功能，用户可以与 AI 助手进行自由对话，获取任务管理建议、时间规划技巧或其他帮助。

## 主要功能

### 1. 对话界面
- **现代化聊天 UI**：类似 ChatGPT 的对话界面
- **消息气泡**：用户和 AI 的消息用不同样式区分
- **头像标识**：用户和 AI 机器人图标
- **时间戳**：每条消息显示发送时间
- **自动滚动**：新消息自动滚动到底部

### 2. 输入体验
- **多行输入**：支持换行输入（Shift + Enter）
- **自动调整高度**：输入框根据内容自动调整高度
- **快捷发送**：Enter 键直接发送
- **输入验证**：空消息无法发送
- **加载状态**：发送时显示加载动画

### 3. 快速开始
提供 4 个预设问题，帮助用户快速开始对话：
- 💡 如何提高工作效率？
- 📚 帮我制定一个学习计划
- ⚖️ 如何平衡工作和生活？
- ⏰ 推荐一些时间管理技巧

### 4. 状态提示
- **未配置提示**：未配置 API Key 时显示醒目提示
- **错误处理**：网络错误或 API 错误时显示错误信息
- **加载指示**：AI 思考时显示"AI 正在思考..."

### 5. 对话管理
- **清空对话**：一键清空所有历史消息
- **持久化存储**：对话记录保存在内存中（刷新后清空）
- **错误恢复**：错误后可以继续对话

## 技术实现

### 前端组件

1. **Chat.tsx** (`src/pages/Chat.tsx`)
   - 主对话页面
   - 消息列表渲染
   - 输入框和发送逻辑
   - 快速开始按钮

2. **chatStore.ts** (`src/stores/chatStore.ts`)
   - Zustand 状态管理
   - 消息历史管理
   - 发送消息逻辑
   - 错误处理

### 后端实现

1. **ai_commands.rs** (`src-tauri/src/commands/ai_commands.rs`)
   - `ai_chat` Tauri 命令
   - 请求验证
   - 响应格式化

2. **ai_service.rs** (`src-tauri/src/services/ai_service.rs`)
   - `chat` 方法
   - DeepSeek API 调用
   - 错误处理和重试

3. **deepseek_provider.rs** (在 ai_service.rs 中)
   - `chat` 方法实现
   - HTTP 请求构建
   - 响应解析

### API 集成

**请求格式**：
```json
{
  "model": "deepseek-chat",
  "messages": [
    {
      "role": "system",
      "content": "你是一个专业的任务管理和时间规划助手..."
    },
    {
      "role": "user",
      "content": "用户的消息"
    }
  ],
  "temperature": 0.7,
  "max_tokens": 2000
}
```

**响应格式**：
```json
{
  "message": "AI 的回复内容",
  "timestamp": "2025-10-21T12:00:00Z"
}
```

## 使用方法

### 1. 配置 API Key
- 前往设置页面
- 输入 DeepSeek API Key
- 保存设置

### 2. 开始对话
- 点击侧边栏的"AI 对话"
- 或使用快捷键 `Ctrl/Cmd + 4`
- 或使用 Go 序列 `G` 然后 `A`

### 3. 发送消息
- 在输入框中输入消息
- 按 Enter 发送
- 或点击发送按钮

### 4. 查看回复
- AI 回复会自动显示在对话列表中
- 支持多轮对话
- 历史消息保留在页面中

## 快捷键

- `Ctrl/Cmd + 4` - 前往 AI 对话页面
- `G` 然后 `A` - Go 序列跳转到 AI 对话
- `Enter` - 发送消息
- `Shift + Enter` - 换行

## 路由配置

- **路径**: `/chat`
- **导航**: 侧边栏第四项
- **图标**: MessageSquare (消息气泡)

## 特性亮点

### 1. 智能助手定位
系统提示词设定为"专业的任务管理和时间规划助手"，确保 AI 回复与应用主题相关。

### 2. 友好的用户体验
- 空状态引导
- 预设问题快速开始
- 清晰的视觉反馈
- 流畅的动画效果

### 3. 错误处理
- 网络错误提示
- API 错误提示
- 未配置提示
- 可关闭的错误消息

### 4. 响应式设计
- 适配不同屏幕尺寸
- 移动端友好
- 消息气泡自适应宽度

## 开发模式

在开发模式下（未连接 Tauri），会使用模拟响应：
- 随机返回预设的回复
- 模拟 1 秒延迟
- 用于前端开发和测试

## 未来改进

可能的增强功能：
- [ ] 对话历史持久化（保存到数据库）
- [ ] 多会话管理（创建多个对话）
- [ ] 导出对话记录
- [ ] 语音输入支持
- [ ] Markdown 渲染（代码高亮等）
- [ ] 流式响应（逐字显示）
- [ ] 上下文记忆（记住之前的对话）
- [ ] 快捷指令（如 /help, /plan 等）
- [ ] 对话分享功能
- [ ] AI 建议直接转为任务

## 注意事项

1. **API Key 必需**：需要配置 DeepSeek API Key 才能使用
2. **网络连接**：需要稳定的网络连接
3. **Token 消耗**：每次对话会消耗 API Token
4. **响应时间**：取决于网络和 API 响应速度
5. **内容限制**：单次对话最多 2000 tokens

## 安全性

- API Key 加密存储
- 敏感信息自动脱敏
- 不记录用户隐私数据
- 本地处理，不上传到第三方服务器
