{
  "id": "snapshot_1759860761399_9m4ig3zkr",
  "approvalId": "approval_1759860761381_n4cbi59f7",
  "approvalTitle": "Phase 0 Foundation - Tasks Document",
  "version": 1,
  "timestamp": "2025-10-07T18:12:41.399Z",
  "trigger": "initial",
  "status": "pending",
  "content": "# Tasks - Phase 0 Foundation\r\n\r\n- [ ] 1. Bootstrap Tauri + React 项目骨架\r\n  - File: package.json; pnpm-lock.yaml; src/main.tsx; src-tauri/Cargo.toml; src-tauri/tauri.conf.json; .gitignore; tsconfig.json; vite.config.ts; README.md\r\n  - Actions:\r\n    - 使用 `pnpm dlx create-tauri-app` 生成 Tauri 2 + React + TypeScript 项目\r\n    - 选择 pnpm、Vite、TypeScript、React 模板\r\n    - 校验生成的基础目录结构与 `structure.md` 一致，并删除模板多余文件\r\n  - Purpose: 满足 Requirement 1，建立可运行的桌面应用基础框架\r\n  - _Leverage: .spec-workflow/steering/structure.md; .spec-workflow/steering/tech.md_\r\n  - _Requirements: Req 1_\r\n  - _Prompt: Implement the task for spec phase0-foundation, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Full-stack Engineer with Tauri 2 experience | Task: Initialize the repository using create-tauri-app, align generated files with steering structure, remove template boilerplate not needed for CogniCal | Restrictions: Do not introduce unpinned dependencies, keep generated comments unless harmful, preserve package manager locks | _Leverage: review steering docs for expected layout | _Requirements: Requirement 1 | Success: `pnpm run tauri dev` 启动成功、目录结构符合 `structure.md` | Instructions: 在开始前把本条目标记为 `[-]`，完成后改为 `[x]`, 并保持其他任务状态不变_\r\n\r\n- [ ] 2. 配置前端依赖与开发工具链\r\n  - File: package.json; pnpm-lock.yaml; tsconfig.json; vite.config.ts; .eslintrc.cjs; .prettierrc; tailwind.config.js; postcss.config.cjs; src/main.tsx; src/App.tsx\r\n  - Actions:\r\n    - 安装 & 配置 Tailwind CSS、PostCSS、Autoprefixer、shadcn/ui CLI、Lucide React、Framer Motion\r\n    - 安装 React Router v6、@tanstack/react-query、Zustand、react-hook-form、zod\r\n    - 配置 ESLint + Prettier + TypeScript Strict 模式，新增 `lint` `format` `typecheck` `dev` `build` 脚本\r\n    - 初始化 Tailwind 与 shadcn/ui 基础主题文件，并引入全局样式\r\n  - Purpose: 满足 Requirements 2、3、10，建立现代化前端栈\r\n  - _Leverage: shadcn/ui 官方 CLI; Tailwind 文档_\r\n  - _Requirements: Req 2, Req 3, Req 10_\r\n  - _Prompt: Implement the task for spec phase0-foundation, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Frontend Tooling Engineer | Task: Wire up Tailwind、shadcn/ui、Zustand、React Router、lint/format/typecheck 脚本，确保 Vite dev server 1 秒内热更新 | Restrictions: 避免引入未列出的库，所有配置文件使用 ESModule 或 CJS 与 tooling 兼容 | _Leverage: Refer to steering tech stack描述 | _Requirements: Requirements 2/3/10 | Success: `pnpm run lint`、`pnpm run typecheck`、`pnpm run dev` 正常工作，UI 可渲染基础页面 | Instructions: 将任务状态从 `[ ]` 改为 `[-]` 后开始，完成后改 `[x]`\r\n\r\n- [ ] 3. 建立前端目录与基准组件\r\n  - File: src/App.tsx; src/routes/index.tsx; src/components/layout/AppShell.tsx; src/components/layout/Sidebar.tsx; src/components/layout/Header.tsx; src/pages/Dashboard.tsx; src/pages/Tasks.tsx; src/pages/Settings.tsx; src/styles/globals.css; src/types/task.ts; src/utils/constants.ts\r\n  - Actions:\r\n    - 按 `structure.md` 创建 `components/`, `pages/`, `hooks/`, `stores/`, `services/`, `types/`, `utils/`, `styles/` 目录\r\n    - 实现导航布局（侧边栏 + Header + 主内容区）和基础路由\r\n    - 提供示例页面骨架，展示 Tailwind + shadcn/ui 主题切换\r\n  - Purpose: 满足 Requirements 2、8，提供统一 UI 框架\r\n  - _Leverage: shadcn/ui Layout 模式; steering/structure.md_\r\n  - _Requirements: Req 2, Req 8_\r\n  - _Prompt: Implement the task for spec phase0-foundation, first run spec-workflow-guide to get the workflow guide then implement the task: Role: React UI Developer | Task: Build reusable布局组件与基础路由，确保导航高亮与响应式折叠 | Restrictions: 不要实现真实业务逻辑，占位内容需可扩展 | _Leverage: 参考结构文档与设计文档中 AppShell 段落 | _Requirements: Requirements 2/8 | Success: `Tasks` 页面可通过导航展示，占位内容清晰且主题切换正常 | Instructions: 标记 `[-]` 开始，完成置 `[x]`\r\n\r\n- [ ] 4. 构建前端任务状态与 Tauri 调用封装\r\n  - File: src/stores/taskStore.ts; src/services/tauriApi.ts; src/hooks/useTasks.ts; src/types/task.ts; src/utils/validators.ts\r\n  - Actions:\r\n    - 定义 `Task`、`TaskPayload` 等 TypeScript 类型\r\n    - 使用 Zustand 创建 `taskStore`，封装 `fetch/create/update/delete`\r\n    - 封装 Tauri `invoke` 包装器，统一错误处理与 loading 状态\r\n    - 编写 zod schema 保证前端字段验证\r\n  - Purpose: 满足 Requirements 6、7，建立前端与后端通信桥梁\r\n  - _Leverage: design.md 中 Component 3/4 描述_\r\n  - _Requirements: Req 6, Req 7_\r\n  - _Prompt: Implement the task for spec phase0-foundation, first run spec-workflow-guide to get the workflow guide then implement the task: Role: React State Management Specialist | Task: 实现 taskStore 和 tauriApi wrapper，提供类型安全的 CRUD 方法并处理错误提示 | Restrictions: 不直接在组件中调用 `invoke`，所有错误通过 store 暴露 | _Leverage: 参考设计文档中的 TaskStore 章节 | _Requirements: Requirements 6/7 | Success: store 方法在单元测试或 storybook sandbox 下可被调用，错误与 loading 状态可靠 | Instructions: 任务开始前 `[ ]` -> `[-]`，完成后 `[x]`\r\n\r\n- [ ] 5. 初始化 SQLite 数据库与连接层\r\n  - File: src-tauri/src/db/mod.rs; src-tauri/src/db/connection.rs; src-tauri/src/db/schema.sql; src-tauri/src/db/migrations.rs; src-tauri/src/utils/path.rs; Cargo.toml\r\n  - Actions:\r\n    - 使用 `rusqlite` 建立连接池（或基于 `Arc<Mutex<Connection>>` 的安全封装）\r\n    - 在 `schema.sql` 中创建 `tasks`、`users` 表并应用约束\r\n    - 实现应用启动时的数据库初始化逻辑，确保首次运行自动建库\r\n    - 预留迁移接口（如 `migrations.rs`）\r\n  - Purpose: 满足 Requirements 1、5，为数据持久化铺路\r\n  - _Leverage: design.md Data Models; tech.md Database Schema_\r\n  - _Requirements: Req 1, Req 5_\r\n  - _Prompt: Implement the task for spec phase0-foundation, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Rust Backend Engineer 专注 SQLite | Task: 搭建数据库连接、初始化 schema、处理首次启动建库，以及错误日志 | Restrictions: 不引入 Diesel，保持 rusqlite + async runtime 兼容 | _Leverage: 参考 design.md Task/User 表定义 | _Requirements: Requirements 1/5 | Success: 应用启动后生成数据库文件且含正确表结构，日志记录失败原因 | Instructions: `[ ]` -> `[-]` -> `[x]`\r\n\r\n- [ ] 6. 实现 TaskRepository 与 TaskService\r\n  - File: src-tauri/src/db/repositories/task_repository.rs; src-tauri/src/services/task_service.rs; src-tauri/src/models/task.rs; src-tauri/src/error.rs\r\n  - Actions:\r\n    - 将 CRUD SQL 操作封装在 `TaskRepository`\r\n    - 在 `TaskService` 中实现业务逻辑、DTO 转换、验证以及事务\r\n    - 定义 `TaskEntity` 结构体，支持 serde 序列化\r\n    - 统一错误类型（如 `AppError`）并映射数据库错误\r\n  - Purpose: 满足 Requirements 5、6、7，建立后端业务层\r\n  - _Leverage: design.md Component 5; Error Handling 部分_\r\n  - _Requirements: Req 5, Req 6, Req 7_\r\n  - _Prompt: Implement the task for spec phase0-foundation, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Rust Service Layer Engineer | Task: 完成 repository + service，覆盖 CRUD、验证、错误映射 | Restrictions: SQL 语句使用参数绑定防止注入，事务使用 rusqlite Transaction | _Leverage: 设计文档 TaskService 描述 | _Requirements: Requirements 5/6/7 | Success: `TaskService` 单元测试可 CRUD 成功，错误时返回结构化 AppError | Instructions: 更新任务勾选状态\r\n\r\n- [ ] 7. 暴露 Tauri Commands 并注册应用启动流程\r\n  - File: src-tauri/src/commands/mod.rs; src-tauri/src/commands/task.rs; src-tauri/src/main.rs; src-tauri/src/services/bootstrap_service.rs; tauri.conf.json\r\n  - Actions:\r\n    - 实现 `create_task`, `get_all_tasks`, `get_task_by_id`, `update_task`, `delete_task`\r\n    - 在主函数中注册命令、初始化数据库、注入共享状态\r\n    - 配置 `tauri.conf.json` 权限（通知、文件系统、托盘占位）\r\n  - Purpose: 满足 Requirements 7、9，桥接前后端\r\n  - _Leverage: design.md Component 4/6; tech.md System Integration_\r\n  - _Requirements: Req 7, Req 9_\r\n  - _Prompt: Implement the task for spec phase0-foundation, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Tauri Backend Engineer | Task: 编写命令 handler，注册到 Tauri Builder，确保应用启动时初始化数据库 | Restrictions: 所有命令必须返回 `Result<_, AppError>`，不可在 handler 中直接 unwrap | _Leverage: 设计中命令清单 | _Requirements: Requirements 7/9 | Success: 前端调用 CRUD 命令均返回预期数据，应用具备通知/托盘权限配置 | Instructions: 标记任务状态\r\n\r\n- [ ] 8. 构建任务 CRUD 前端界面与交互\r\n  - File: src/components/tasks/TaskTable.tsx; src/components/tasks/TaskFormDialog.tsx; src/components/tasks/TaskDetailsDrawer.tsx; src/pages/Tasks.tsx; src/hooks/useTaskForm.ts; src/utils/formSchemas.ts\r\n  - Actions:\r\n    - 使用 shadcn/ui Table、Dialog、Form 组件实现任务列表、创建/编辑弹窗、详情抽屉\r\n    - 集成 `taskStore` 行为，实现加载态、错误提示、分页/排序（基础）\r\n    - 集成表单验证（react-hook-form + zod）\r\n  - Purpose: 满足 Requirements 3、6、8\r\n  - _Leverage: shadcn/ui Form/Table; design.md Component 2 | Requirement 6 验收标准_\r\n  - _Requirements: Req 3, Req 6, Req 8_\r\n  - _Prompt: Implement the task for spec phase0-foundation, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Senior React Developer | Task: 构建完整任务 CRUD UI，打通 store 和命令，确保提示文案友好 | Restrictions: 不直接访问数据库 mock，全部通过 store 调用 | _Leverage: 设计文档 TaskListPage 描述 | _Requirements: Requirements 3/6/8 | Success: 手动验证创建、编辑、删除流程可用，状态提示准确 | Instructions: 按规范更新任务状态\r\n\r\n- [ ] 9. 构建错误处理、日志与用户提示机制\r\n  - File: src/components/common/ToastProvider.tsx; src/stores/uiStore.ts; src/utils/errorMapper.ts; src-tauri/src/error.rs; src-tauri/src/utils/logger.rs; tauri.conf.json\r\n  - Actions:\r\n    - 在前端实现全局 Toast/Snackbar，响应 store 和命令错误\r\n    - 后端扩展 `AppError`，记录日志文件，并在 CLI 输出清晰错误\r\n    - 配置 Tauri error dialog 与日志路径\r\n  - Purpose: 满足 Requirements 6、9、Security/Reliability 非功能需求\r\n  - _Leverage: design.md Error Handling 部分_\r\n  - _Requirements: Req 6, Req 9; NFR Reliability/Security_\r\n  - _Prompt: Implement the task for spec phase0-foundation, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Reliability-focused Engineer | Task: 实现统一错误提示与日志记录，确保数据库/命令异常有清晰反馈 | Restrictions: 日志中不得泄漏敏感数据，Toast 文案需可本地化 | _Leverage: 设计文档 Error Handling 场景 | _Requirements: Requirements 6/9 + NFR | Success: 触发错误时用户看到提示，日志文件写入详细信息 | Instructions: 更新任务勾选状态\r\n\r\n- [ ] 10. 测试与工具链落地\r\n  - File: package.json; pnpm-lock.yaml; vitest.config.ts; src/__tests__/taskStore.test.ts; tests/integration/task_service_tests.rs; playwright.config.ts; .husky/pre-commit; .lintstagedrc\r\n  - Actions:\r\n    - 配置 Vitest、React Testing Library、Playwright 基础文件\r\n    - 编写 `taskStore` 单元测试、`TaskService` Rust 集成测试\r\n    - 初始化 Husky + lint-staged，在提交前运行 `lint`、`format`\r\n    - 文档化运行方式（更新 README）\r\n  - Purpose: 满足 Requirements 10、Testing Strategy\r\n  - _Leverage: design.md Testing Strategy; tech.md CI/CD_\r\n  - _Requirements: Req 10; NFR Maintainability/Reliability_\r\n  - _Prompt: Implement the task for spec phase0-foundation, first run spec-workflow-guide to get the workflow guide then implement the task: Role: QA Automation & Tooling Engineer | Task: 落地测试与 Husky workflow，提供最小可行测试示例，更新 README | Restrictions: 测试需在 CI 无头模式运行，Husky 钩子保持跨平台 | _Leverage: 设计文档测试策略 | _Requirements: Requirement 10 + NFR | Success: `pnpm test`, `cargo test`, `pnpm run e2e`（占位）命令可执行，pre-commit 阻止未格式化代码 | Instructions: 按规范更新任务状态\r\n",
  "fileStats": {
    "size": 12974,
    "lines": 117,
    "lastModified": "2025-10-07T18:12:34.368Z"
  },
  "comments": []
}