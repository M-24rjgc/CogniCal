{
  "id": "snapshot_1760695078664_05ssr28c0",
  "approvalId": "approval_1760695078585_6babifvp0",
  "approvalTitle": "首页仪表盘简化设计文档",
  "version": 1,
  "timestamp": "2025-10-17T09:57:58.664Z",
  "trigger": "initial",
  "status": "pending",
  "content": "# Design Document\r\n\r\n## Overview\r\n\r\n本设计文档详细描述CogniCal首页仪表盘简化功能的技术实现方案。该功能通过引入渐进式信息展示、可自定义仪表盘配置和快速入口区域，解决当前Dashboard界面信息过载的问题。设计遵循现有的React + TypeScript + Tauri架构，利用Zustand状态管理和shadcn/ui组件库，确保与现有系统的无缝集成。\r\n\r\n## Steering Document Alignment\r\n\r\n### Technical Standards (tech.md)\r\n\r\n**前端技术栈遵循**：\r\n- **React 18+ with TypeScript**: 所有新组件使用函数式组件和严格TypeScript类型\r\n- **Tailwind CSS + shadcn/ui**: 复用现有设计系统，保持视觉一致性\r\n- **Zustand状态管理**: 扩展现有settingsStore，新增dashboard配置状态\r\n- **React Query**: 利用现有数据获取模式，保持缓存和错误处理一致性\r\n\r\n**后端集成**：\r\n- **Tauri Commands**: 通过现有tauriApi服务层调用后端命令\r\n- **SQLite本地存储**: 配置数据持久化到现有settings表\r\n- **类型安全**: 前后端共享TypeScript类型定义\r\n\r\n### Project Structure (structure.md)\r\n\r\n**文件组织遵循项目结构**：\r\n- **组件位置**: `src/components/dashboard/` - 新增仪表盘专用组件\r\n- **页面修改**: `src/pages/Dashboard.tsx` - 重构主页面布局\r\n- **状态管理**: `src/stores/settingsStore.ts` - 扩展现有store\r\n- **类型定义**: `src/types/dashboard.ts` - 新增仪表盘配置类型\r\n- **服务集成**: `src/services/tauriApi.ts` - 复用现有API调用模式\r\n\r\n## Code Reuse Analysis\r\n\r\n### Existing Components to Leverage\r\n\r\n- **`AnalyticsOverview`**: 保留核心分析功能，通过props控制显示详细程度\r\n- **`WorkloadForecastBanner`**: 复用现有预警逻辑，支持条件渲染\r\n- **`WeeklySummaryPanel`**: 保持健康概览功能，支持可选显示\r\n- **`Card`, `Button`, `Badge`等shadcn/ui组件**: 维持设计系统一致性\r\n- **`useSettingsStore`**: 扩展而非替换，新增dashboard配置字段\r\n\r\n### Integration Points\r\n\r\n- **Settings页面**: 在现有设置表单中新增仪表盘配置区域\r\n- **tauriApi服务**: 复用现有错误处理和类型转换机制\r\n- **数据库schema**: 扩展settings表，新增dashboard_config JSON字段\r\n- **主题系统**: 确保深色/浅色主题完全兼容\r\n\r\n## Architecture\r\n\r\n### Modular Design Principles\r\n\r\n- **Single File Responsibility**: 每个仪表盘模块独立文件，单一职责\r\n- **Component Isolation**: 创建可复用的模块容器组件，支持独立渲染\r\n- **Service Layer Separation**: 配置管理通过settingsStore统一处理\r\n- **Utility Modularity**: 工具函数按功能分组，便于测试和维护\r\n\r\n```mermaid\r\ngraph TD\r\n    A[Dashboard Page] --> B[QuickActions Bar]\r\n    A --> C[ModuleContainer]\r\n    C --> D[TodayTasksOverview]\r\n    C --> E[ProductivityScoreCard]\r\n    C --> F[UpcomingTasksAlert]\r\n    C --> G[WorkloadForecastBanner]\r\n    C --> H[AnalyticsOverview]\r\n    C --> I[WeeklySummaryPanel]\r\n    \r\n    J[SettingsStore] --> K[DashboardConfig]\r\n    J --> L[Settings Integration]\r\n    \r\n    M[Settings Page] --> N[Dashboard Settings Form]\r\n    \r\n    K --> C\r\n    L --> N\r\n    \r\n    O[Tauri API] --> P[Settings Commands]\r\n    J --> O\r\n```\r\n\r\n## Components and Interfaces\r\n\r\n### Component 1: DashboardPage (重构)\r\n\r\n- **Purpose:** 主仪表盘页面，协调所有模块的显示和布局\r\n- **Interfaces:** \r\n  - `useDashboardConfig()` - 获取用户配置\r\n  - `renderModule()` - 根据配置渲染模块\r\n- **Dependencies:** settingsStore, 所有子模块组件\r\n- **Reuses:** 现有页面布局结构，响应式设计模式\r\n\r\n### Component 2: QuickActionsBar (新增)\r\n\r\n- **Purpose:** 顶部快速操作区域，提供常用功能入口\r\n- **Interfaces:** \r\n  - `onCreateTask()` - 创建任务回调\r\n  - `onOpenCalendar()` - 打开日历回调\r\n  - `onGeneratePlan()` - 生成智能规划回调\r\n- **Dependencies:** 路由系统, 任务创建hook\r\n- **Reuses:** Button组件，图标系统，现有导航模式\r\n\r\n### Component 3: ModuleContainer (新增)\r\n\r\n- **Purpose:** 模块容器组件，支持条件渲染和懒加载\r\n- **Interfaces:** \r\n  - `moduleId: string` - 模块标识\r\n  - `isVisible: boolean` - 是否显示\r\n  - `children: ReactNode` - 子组件\r\n- **Dependencies:** React懒加载机制\r\n- **Reuses:** Card组件，现有加载状态处理\r\n\r\n### Component 4: TodayTasksOverview (新增)\r\n\r\n- **Purpose:** 今日任务概览，显示当天关键任务信息\r\n- **Interfaces:** \r\n  - `useTodayTasks()` - 获取今日任务数据\r\n  - `onTaskAction()` - 任务操作回调\r\n- **Dependencies:** taskStore, 日期处理工具\r\n- **Reuses:** 现有任务列表组件，Badge组件\r\n\r\n### Component 5: ProductivityScoreCard (简化版)\r\n\r\n- **Purpose:** 简化版生产力评分卡片，突出核心指标\r\n- **Interfaces:** \r\n  - `useProductivityScore()` - 获取评分数据\r\n  - `showDetails: boolean` - 是否显示详细信息\r\n- **Dependencies:** analyticsStore, 评分计算逻辑\r\n- **Reuses:** 现有ProductivityScoreCard组件，条件渲染\r\n\r\n### Component 6: UpcomingTasksAlert (新增)\r\n\r\n- **Purpose:** 即将到期任务提醒，预警时间敏感任务\r\n- **Interfaces:** \r\n  - `useUpcomingTasks()` - 获取即将到期任务\r\n  - `timeThreshold: number` - 时间阈值配置\r\n- **Dependencies:** taskStore, 时间计算工具\r\n- **Reuses:** Alert组件，现有任务时间处理逻辑\r\n\r\n### Component 7: DashboardSettingsForm (新增)\r\n\r\n- **Purpose:** 设置页面中的仪表盘配置表单\r\n- **Interfaces:** \r\n  - `config: DashboardConfig` - 当前配置\r\n  - `onConfigChange()` - 配置变更回调\r\n- **Dependencies:** settingsStore, 表单验证\r\n- **Reuses:** 现有设置表单模式，Switch组件，Button组件\r\n\r\n## Data Models\r\n\r\n### TypeScript Interfaces\r\n\r\n```typescript\r\n// src/types/dashboard.ts\r\nexport interface DashboardConfig {\r\n  // 核心模块（默认显示）\r\n  showTodayTasksOverview: boolean;\r\n  showProductivityScoreCard: boolean;\r\n  showUpcomingTasksAlert: boolean;\r\n  \r\n  // 可选模块（用户配置）\r\n  showWorkloadForecastBanner: boolean;\r\n  showAnalyticsOverview: boolean;\r\n  showWeeklySummaryPanel: boolean;\r\n  showTimeAllocationChart: boolean;\r\n  showEfficiencyInsights: boolean;\r\n  showTodayFocusTime: boolean;\r\n  \r\n  // 显示模式\r\n  isCompactMode: boolean;\r\n  expandedModules: string[];\r\n}\r\n\r\nexport interface DashboardModule {\r\n  id: string;\r\n  title: string;\r\n  description: string;\r\n  defaultVisible: boolean;\r\n  category: 'core' | 'optional';\r\n  component: React.ComponentType<any>;\r\n}\r\n\r\nexport interface QuickAction {\r\n  id: string;\r\n  label: string;\r\n  icon: React.ComponentType<{ className?: string }>;\r\n  action: () => void;\r\n  variant?: 'default' | 'outline';\r\n}\r\n```\r\n\r\n### Database Schema Extension\r\n\r\n```sql\r\n-- 扩展现有settings表\r\nALTER TABLE settings ADD COLUMN dashboard_config TEXT DEFAULT '{}';\r\n\r\n-- 默认配置JSON\r\n{\r\n  \"showTodayTasksOverview\": true,\r\n  \"showProductivityScoreCard\": true,\r\n  \"showUpcomingTasksAlert\": true,\r\n  \"showWorkloadForecastBanner\": false,\r\n  \"showAnalyticsOverview\": false,\r\n  \"showWeeklySummaryPanel\": false,\r\n  \"showTimeAllocationChart\": false,\r\n  \"showEfficiencyInsights\": false,\r\n  \"showTodayFocusTime\": false,\r\n  \"isCompactMode\": true,\r\n  \"expandedModules\": []\r\n}\r\n```\r\n\r\n## State Management\r\n\r\n### SettingsStore Extension\r\n\r\n```typescript\r\n// 扩展src/stores/settingsStore.ts\r\ninterface SettingsStoreState {\r\n  // ... 现有字段\r\n  \r\n  // 新增仪表盘配置\r\n  dashboardConfig: DashboardConfig | null;\r\n  isDashboardConfigLoading: boolean;\r\n  \r\n  // 新增方法\r\n  loadDashboardConfig: () => Promise<DashboardConfig>;\r\n  updateDashboardConfig: (config: Partial<DashboardConfig>) => Promise<DashboardConfig>;\r\n  resetDashboardConfig: () => Promise<DashboardConfig>;\r\n  toggleModule: (moduleId: string) => Promise<void>;\r\n}\r\n```\r\n\r\n## Implementation Strategy\r\n\r\n### Phase 1: Core Infrastructure\r\n\r\n1. **类型定义和数据库扩展**\r\n   - 创建`src/types/dashboard.ts`\r\n   - 实现数据库迁移脚本\r\n   - 扩展settings store\r\n\r\n2. **基础组件开发**\r\n   - ModuleContainer组件\r\n   - QuickActionsBar组件\r\n   - DashboardSettingsForm组件\r\n\r\n### Phase 2: New Modules\r\n\r\n3. **核心模块实现**\r\n   - TodayTasksOverview组件\r\n   - UpcomingTasksAlert组件\r\n   - ProductivityScoreCard简化版\r\n\r\n4. **集成和配置**\r\n   - 重构DashboardPage\r\n   - 设置页面集成\r\n   - 默认配置应用\r\n\r\n### Phase 3: Polish and Optimization\r\n\r\n5. **用户体验优化**\r\n   - 动画和过渡效果\r\n   - 响应式设计完善\r\n   - 无障碍访问支持\r\n\r\n6. **性能优化**\r\n   - 懒加载实现\r\n   - 缓存策略\r\n   - 渲染优化\r\n\r\n## Testing Strategy\r\n\r\n### Unit Tests\r\n\r\n- **组件测试**: 每个新组件的渲染和交互\r\n- **Hook测试**: dashboard配置相关hooks\r\n- **工具函数测试**: 配置验证和转换函数\r\n\r\n### Integration Tests\r\n\r\n- **页面集成测试**: Dashboard页面完整流程\r\n- **设置集成测试**: 配置保存和应用\r\n- **数据流测试**: 前后端配置同步\r\n\r\n### E2E Tests\r\n\r\n- **用户流程测试**: 从设置到应用的完整流程\r\n- **跨主题测试**: 深色/浅色主题兼容性\r\n- **性能测试**: 页面加载和交互响应时间\r\n\r\n## Performance Considerations\r\n\r\n### Rendering Optimization\r\n\r\n- **条件渲染**: 只渲染用户启用的模块\r\n- **懒加载**: 可选模块使用React.lazy()\r\n- **虚拟化**: 大列表使用虚拟滚动\r\n\r\n### Data Optimization\r\n\r\n- **缓存策略**: 配置数据本地缓存\r\n- **批量更新**: 配置变更批量处理\r\n- **预加载**: 关键数据预加载机制\r\n\r\n## Security Considerations\r\n\r\n### Data Validation\r\n\r\n- **配置验证**: 严格的类型检查和边界验证\r\n- **输入清理**: 防止XSS和注入攻击\r\n- **权限控制**: 确保用户只能修改自己的配置\r\n\r\n### Privacy Protection\r\n\r\n- **本地存储**: 配置数据完全本地化\r\n- **数据加密**: 敏感配置加密存储\r\n- **审计日志**: 配置变更记录和追踪\r\n\r\n## Accessibility\r\n\r\n### WCAG 2.1 Compliance\r\n\r\n- **键盘导航**: 所有交互支持键盘操作\r\n- **屏幕阅读器**: 语义化HTML和ARIA标签\r\n- **颜色对比**: 满足4.5:1对比度要求\r\n- **焦点管理**: 清晰的焦点指示和逻辑顺序\r\n\r\n### Internationalization\r\n\r\n- **多语言支持**: 所有新增文本支持i18n\r\n- **RTL支持**: 从右到左语言布局适配\r\n- **文化适配**: 考虑不同文化背景的用户习惯",
  "fileStats": {
    "size": 10499,
    "lines": 332,
    "lastModified": "2025-10-17T09:57:49.667Z"
  },
  "comments": []
}