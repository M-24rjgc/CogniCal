{
  "id": "snapshot_1760323886440_5vgo1nbz4",
  "approvalId": "approval_1760323886304_1k73pudug",
  "approvalTitle": "Phase 4 Productivity Optimization Task Plan",
  "version": 1,
  "timestamp": "2025-10-13T02:51:26.440Z",
  "trigger": "initial",
  "status": "pending",
  "content": "# Task Plan - Phase 4 Productivity Optimization\r\n\r\n## Overview\r\nThis task plan breaks the approved design into executable units across Rust services, React UI, data migrations, and testing. Each task references relevant requirements and design sections, includes acceptance criteria, and is sized to fit within the existing repo structure.\r\n\r\n## Task Breakdown\r\n\r\n### Task 1 ‚Äî Data Model & Migration Foundations\r\n- **Workstream:** Rust backend, SQLite migrations\r\n- **Description:** Introduce new tables (`productivity_scores`, `recommendation_sessions`, `recommendation_decisions`, `workload_forecasts`, `wellness_events`, `ai_feedback`, `community_exports`) and extend existing analytics/tasks tables with Phase 4 fields.\r\n- **Deliverables:**\r\n  - Rust migration scripts and updated models with Diesel/rusqlite bindings.\r\n  - Unit tests for schema CRUD operations.\r\n  - Documentation updates for schema diagrams.\r\n- **Acceptance Criteria:**\r\n  - Migrations run idempotently and integrate with existing migration pipeline.\r\n  - All new models exposed via DAL helpers with typed structs.\r\n  - `cargo test` covering CRUD + serialization passes.\r\n- **Dependencies:** Requirements ¬ßProductivity Scoring, ¬ßWorkload Forecasts; Design ¬ßData Models.\r\n\r\n### Task 2 ‚Äî Productivity Score Engine & API\r\n- **Workstream:** Rust services + IPC commands\r\n- **Description:** Implement `ProductivityScoreEngine` to calculate composite and per-dimension scores, persist snapshots, and expose Tauri commands.\r\n- **Deliverables:**\r\n  - New service module with calculation logic, weight configuration, and explanation generation.\r\n  - IPC command `analytics_get_productivity_score` returning score bundle with history.\r\n  - Unit/integration tests covering scoring formulas and history retrieval.\r\n- **Acceptance Criteria:**\r\n  - Scores align with requirements: dimensions, hover explanations, insufficient data handling.\r\n  - History endpoint supports 7/30/90-day ranges with caching.\r\n  - Offline behaviour preserves latest local score.\r\n- **Dependencies:** Task 1 (schema), Design Components 1 & 2.\r\n\r\n### Task 3 ‚Äî Frontend Productivity Score Surfaces\r\n- **Workstream:** React UI + Zustand + hooks\r\n- **Description:** Extend analytics dashboard with composite score card, per-dimension breakdown, and trend chart enhancements.\r\n- **Deliverables:**\r\n  - `useProductivityScore` hook orchestrating IPC calls, caching state in analytics store.\r\n  - Updates to `SummaryCards`, `ProductivityTrendChart`, and new breakdown component for weights/explanations.\r\n  - Vitest suites for hook behaviour and component rendering.\r\n- **Acceptance Criteria:**\r\n  - Dashboard shows 0‚Äì100 score, dimension hover details, and trend toggles.\r\n  - Loading, zero-state, demo data, and fallback copy match requirements.\r\n  - Accessibility: keyboard/focus states and screen-reader labels verified.\r\n- **Dependencies:** Task 2 (backend data).\r\n\r\n### Task 4 ‚Äî Recommendation Orchestrator & Fallbacks\r\n- **Workstream:** Rust services + AI integration\r\n- **Description:** Implement multi-option plan generation, capture decisions, and handle DeepSeek/offline fallbacks.\r\n- **Deliverables:**\r\n  - `RecommendationOrchestrator` service calling DeepSeek with CoT prompts, fallback heuristics, and conflict detection.\r\n  - IPC command `planning_generate_recommendations` returning plan options with metadata.\r\n  - Decision logging utilities writing to `recommendation_decisions`.\r\n  - Unit tests mocking DeepSeek responses and verifying fallback logic.\r\n- **Acceptance Criteria:**\r\n  - At least three ranked plans produced when online; cached/heuristic path activates within 2 seconds when offline.\r\n  - Conflict annotations and resolution options supplied as per requirements.\r\n  - User decisions recorded with timestamps and preference tags.\r\n- **Dependencies:** Task 1 (schema), Requirements ¬ßAI Recommendations, Design Components 3 & 4.\r\n\r\n### Task 5 ‚Äî Planning UI Enhancements\r\n- **Workstream:** React components + stores + UX\r\n- **Description:** Update `TaskPlanningPanel`, `ConflictResolutionSheet`, and related components to display new plan options, conflict badges, and decision recording UI.\r\n- **Deliverables:**\r\n  - Store updates to capture plan sessions, user responses, and fallback hints.\r\n  - UI changes for multi-option display, conflict resolution actions, offline banners.\r\n  - Vitest + React Testing Library coverage for acceptance flows.\r\n- **Acceptance Criteria:**\r\n  - Users can request plans, view ‚â•3 options, resolve conflicts, accept/snooze with clear feedback.\r\n  - Offline state shows cache usage and encourages retry.\r\n  - Decisions propagate to backend via new commands.\r\n- **Dependencies:** Task 4 (backend API), existing planning components.\r\n\r\n### Task 6 ‚Äî Workload Forecasting & Capacity Safeguards\r\n- **Workstream:** Rust services + background jobs + notifications\r\n- **Description:** Introduce nightly scheduler job for workload projections, risk classification, and IPC endpoints for dashboards.\r\n- **Deliverables:**\r\n  - `WorkloadForecastService` with horizon projections (7/14/30 days) and capacity checks.\r\n  - IPC command `analytics_get_workload_forecast` returning risk banners.\r\n  - Integration with notification system to surface critical capacity alerts.\r\n  - Tests covering projection maths, low-confidence handling, and alert triggers.\r\n- **Acceptance Criteria:**\r\n  - Job runs within 60s, writes forecast snapshots, marks low confidence when data insufficient.\r\n  - Dashboard/API returns structured risk banners and drill-down details.\r\n  - Notifications respect rate limits and avoid crashes when SQLite contention occurs.\r\n- **Dependencies:** Task 1 (schema), Requirements ¬ßWorkload Forecasting.\r\n\r\n### Task 7 ‚Äî Wellness Nudge Engine & UI\r\n- **Workstream:** Rust services + React UX\r\n- **Description:** Track focus streaks, trigger rest reminders respecting quiet hours, and adapt frequency via exponential back-off.\r\n- **Deliverables:**\r\n  - `WellnessNudgeManager` evaluating session metrics, storing events, and exposing `wellness_get_nudges` command.\r\n  - Frontend `useWellness` hook and `WellnessCenter` UI (modal/toast) for presenting nudges and capturing responses.\r\n  - Tests for trigger logic, quiet hours deferment, and response handling.\r\n- **Acceptance Criteria:**\r\n  - Reminders fire when thresholds exceeded, defer to next window if quiet hours enabled.\r\n  - Responses recorded, subsequent reminders adapt cadence.\r\n  - Weekly summary view displays compliance metrics.\r\n- **Dependencies:** Requirements ¬ßSustainable Focus & Wellness, design component 6, existing notification infrastructure.\r\n\r\n### Task 8 ‚Äî Feedback Capture & Digest\r\n- **Workstream:** Full-stack feedback pipeline\r\n- **Description:** Enable inline üëç/üëé capture with optional notes, regenerate options, and weekly digests summarising adjustments.\r\n- **Deliverables:**\r\n  - Backend `feedback_submit` command storing context snapshots, anonymising payloads, and triggering optional regenerate.\r\n  - Digest generator summarising recurring issues, exposed via settings UI.\r\n  - Frontend components embedding feedback controls in score cards, recommendations, and forecasts.\r\n  - Tests for opt-out, storage wipe, and digest display.\r\n- **Acceptance Criteria:**\r\n  - Feedback controls appear inline, hide when opt-out enabled, and support note entry.\r\n  - Negative feedback captures prompt/context and offers regenerate button when online.\r\n  - Digest summarises adjustments when thresholds exceeded.\r\n- **Dependencies:** Requirements ¬ßAI Feedback Loop, design component 7.\r\n\r\n### Task 9 ‚Äî Community Transparency & Export Tooling\r\n- **Workstream:** Rust services + React dialogs\r\n- **Description:** Surface OSS assurances, detect plugins, and generate anonymised community export packages.\r\n- **Deliverables:**\r\n  - `community_export_bundle` command packaging metrics/feedback snapshots with opt-in gating.\r\n  - Frontend dialog/sheet listing license info, community links, export controls, and plugin discovery display.\r\n  - Tests ensuring offline access, checksum validation, and graceful plugin fallback.\r\n- **Acceptance Criteria:**\r\n  - Welcome/settings panels show OSS messaging even offline.\r\n  - High-tier features operate without gating, display \"Ê∞∏‰πÖÂºÄÊ∫êÂÖçË¥π\" assurance.\r\n  - Export flow produces GitHub-ready Markdown, allows review before sharing.\r\n- **Dependencies:** Requirements ¬ßCommunity Enablement, design component 8.\r\n\r\n### Task 10 ‚Äî QA, Telemetry, and Documentation Updates\r\n- **Workstream:** Cross-functional polish\r\n- **Description:** Consolidate tests, update docs, ensure accessibility, and refresh smoke/E2E coverage.\r\n- **Deliverables:**\r\n  - Updated Playwright smoke test verifying productivity score, risk banners, wellness nudges, and feedback controls.\r\n  - Documentation updates (README, docs/architecture) reflecting new services.\r\n  - Accessibility audit (ARIA labels, keyboard flows) for new UI surfaces.\r\n- **Acceptance Criteria:**\r\n  - All unit/integration/E2E tests pass without flakiness.\r\n  - Docs reflect new commands, tables, and user flows.\r\n  - a11y checks confirm compliance (screen reader descriptions, focus management).\r\n- **Dependencies:** Completion of Tasks 1‚Äì9.\r\n\r\n## Risks & Mitigations\r\n- **DeepSeek latency or outages:** mitigate by strict timeouts, caching, and heuristic fallbacks (Tasks 4 & 5).\r\n- **SQLite contention with nightly jobs:** use transactions and retry policies; schedule batch work during low usage windows (Task 6).\r\n- **User fatigue from reminders/feedback prompts:** back-off strategies and opt-out switches ensure respect for user preferences (Tasks 7 & 8).\r\n- **Export privacy concerns:** enforce anonymisation and explicit opt-in before packaging telemetry (Task 9).\r\n\r\n## Completion Criteria\r\n- All tasks merged with passing tests and documentation updates.\r\n- Productivity dashboard displays new metrics with reliable data.\r\n- Planning workflows offer multi-option AI guidance with fallbacks.\r\n- Users receive workload safeguards, wellness support, feedback transparency, and OSS assurances aligned with the approved requirements.\r\n",
  "fileStats": {
    "size": 10127,
    "lines": 152,
    "lastModified": "2025-10-13T02:51:21.227Z"
  },
  "comments": []
}