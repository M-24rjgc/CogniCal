{
  "id": "snapshot_1760314553890_5m0gdgegt",
  "approvalId": "approval_1760314553745_g7y48cayk",
  "approvalTitle": "phase4-productivity-optimization requirements",
  "version": 1,
  "timestamp": "2025-10-13T00:15:53.890Z",
  "trigger": "initial",
  "status": "pending",
  "content": "# Phase 4: Productivity Optimization & Commercial Readiness - Requirements\r\n\r\n## Introduction\r\n\r\nPhase 4 elevates CogniCal from insights delivery to proactive productivity optimization and commercial readiness. Building on Phase 3's analytics foundation, this phase introduces multi-dimensional productivity scoring, intelligent task and time recommendations, workload forecasting, feedback-driven AI refinement, and the initial metering needed for future monetization. The goal is to transform CogniCal into a closed-loop assistant that not only reports on productivity but actively guides and adapts to each user while preparing the platform for tiered offerings.\r\n\r\n## Alignment with Product Vision\r\n\r\n- **Vision Pillars**: Reinforces the \"Ê¥ûÂØüÂèçÈ¶à‰∏é‰π†ÊÉØÂÖªÊàê\" and \"ÂïÜ‰∏öÂåñÊâ©Â±ï\" pillars by turning analytics into actionable guidance and laying groundwork for freemium-to-paid transitions.\r\n- **Target Personas**: Serves multi-project knowledge workers, self-directed learners, and independent professionals who need predictive support and tailored recommendations to prevent burnout and maintain momentum.\r\n- **Product Principles**:\r\n  - _ÈöêÁßÅ‰ºòÂÖà_: All recommendations, scoring, and metering operate entirely on-device using SQLite and Rust services; no raw productivity data leaves the machine.\r\n  - _Ëß£ÈáäÈÄèÊòé_: Every AI-generated recommendation or score exposes its Chain-of-Thought summary so users can validate rationale.\r\n  - _‰∫∫Êú∫ÂçèÂêå_: Users can accept, reject, or adjust suggestions; feedback immediately informs future guidance.\r\n  - _ËäÇÂ•èÂèãÂ•Ω_: Nudges respect quiet hours, configurable cadence, and avoid interrupting focused sessions.\r\n- **Technical Trajectory**: Extends Phase 3 analytics services with predictive models, recommendation pipelines, and usage metering modules described in steering `tech.md`, ensuring modular services that the upcoming dual-agent system can consume.\r\n\r\n## Requirements\r\n\r\n### Requirement 1: Holistic Productivity Scoring System\r\n\r\n**User Story:** As a multi-project knowledge worker, I want CogniCal to compute a transparent productivity score across key metrics so that I can track my progress and identify areas to improve.\r\n\r\n#### Acceptance Criteria\r\n\r\n1. WHEN the user opens the analytics dashboard THEN the system SHALL display a composite productivity score (0-100) derived from completion rate, on-time ratio, estimated vs actual duration variance, focus adherence, and rest balance.\r\n2. IF the user hovers or taps on the score THEN the system SHALL reveal a detailed breakdown with per-metric weighting and Chain-of-Thought rationale explaining score contributions.\r\n3. WHEN historical data exists for at least 7 days THEN the system SHALL render a trend line segmented by day, week, and month views with minimum 30-day retention.\r\n4. IF data gaps exist for any metric THEN the system SHALL flag the metric as \"insufficient data\" without skewing the aggregate score and provide guidance to capture missing inputs.\r\n\r\n### Requirement 2: Intelligent Task & Time Recommendation Engine\r\n\r\n**User Story:** As an independent professional balancing multiple commitments, I want AI-driven task sequencing and time-slot recommendations so that I can focus on the highest-impact work at the right moments.\r\n\r\n#### Acceptance Criteria\r\n\r\n1. WHEN the user requests recommendations OR the system detects idle planning windows THEN CogniCal SHALL produce at least three ranked task sequencing options, each with a CoT justification and estimated effort window.\r\n2. IF a recommendation conflicts with an existing scheduled block THEN the system SHALL highlight the conflict, propose an alternative time within the same day, and describe the trade-off.\r\n3. WHEN the user accepts, rejects, or defers a recommendation THEN the action SHALL be logged with timestamp and preference metadata for future model tuning.\r\n4. IF the user enables \"automatic plan draft\" in settings THEN the engine SHALL generate a draft plan for the next workday, keeping it in a pending state until explicitly approved.\r\n\r\n### Requirement 3: Workload Forecasting & Capacity Planning\r\n\r\n**User Story:** As a project lead responsible for delivery commitments, I want workload forecasts with risk alerts so that I can anticipate overload and adjust plans proactively.\r\n\r\n#### Acceptance Criteria\r\n\r\n1. WHEN daily analytics run at midnight local time THEN the backend SHALL compute workload projections for the next 7, 14, and 30 days using task backlog, historical throughput, and planned time blocks.\r\n2. IF projected workload exceeds configured capacity for any horizon THEN the system SHALL raise a risk banner with severity level (warning/high) and recommend mitigation actions (shift tasks, extend deadlines, request help).\r\n3. WHEN the user drills into a projection THEN the system SHALL show contributing tasks, assumed durations, and confidence intervals derived from variance history.\r\n4. IF insufficient historical data exists THEN the system SHALL fall back to heuristic estimates and clearly mark the forecast as \"low confidence\" without disabling the feature.\r\n\r\n### Requirement 4: Personalized Rest & Wellness Nudges\r\n\r\n**User Story:** As a productivity enthusiast aiming for sustainable habits, I want personalized rest reminders based on my workload patterns so that I can maintain balance without nagging interruptions.\r\n\r\n#### Acceptance Criteria\r\n\r\n1. WHEN focus session logs or long work streaks exceed configurable thresholds THEN the system SHALL queue a rest nudge containing suggested break length, rationale, and optional breathing or stretch micro-task prompts.\r\n2. IF the user schedules quiet hours or focus mode THEN rest nudges SHALL respect those windows and defer notifications until the next allowed slot.\r\n3. WHEN a user dismisses or snoozes a nudge THEN the system SHALL record the response and adjust future trigger timing using exponential back-off.\r\n4. IF the user requests a wellness summary THEN the system SHALL display weekly rest compliance, streak health, and highlight anomalies (e.g., sustained overtime) with actionable suggestions.\r\n\r\n### Requirement 5: AI Feedback & Continuous Learning Loop\r\n\r\n**User Story:** As a user relying on AI recommendations, I want to rate and comment on AI outputs so that CogniCal can improve future suggestions and transparency.\r\n\r\n#### Acceptance Criteria\r\n\r\n1. WHEN the user interacts with any AI-generated recommendation, score explanation, or forecast THEN the UI SHALL present quick feedback controls (üëç/üëé plus optional note) without leaving the current context.\r\n2. IF the user submits negative feedback THEN the system SHALL capture the prompt, context snapshot, and anonymized metadata for local storage and trigger a retry suggestion if applicable.\r\n3. WHEN feedback accumulates for a recurring issue THEN the system SHALL surface a weekly digest in settings summarizing what changed as a result (e.g., adjusted weights, disabled suggestion type) to maintain trust.\r\n4. IF the user opts out of feedback collection THEN the system SHALL cease surfacing feedback controls while preserving previously stored entries until manually purged.\r\n\r\n### Requirement 6: Commercial Readiness & Usage Metering\r\n\r\n**User Story:** As the product owner preparing for monetization, I want plan-aware usage metering so that we can launch tiered offerings without rewriting core flows later.\r\n\r\n#### Acceptance Criteria\r\n\r\n1. WHEN the app initializes THEN it SHALL load the local plan configuration (Free/Pro/Enterprise) with default Free plan unless overridden via settings or license import.\r\n2. IF the current plan has feature limits (e.g., number of AI recommendations per day) THEN the system SHALL track consumption counters locally, block overages gracefully, and communicate upgrade messaging with no data loss.\r\n3. WHEN the user exports analytics reports or accesses premium-only modules THEN the system SHALL validate entitlement before proceeding and log the event for future billing export.\r\n4. IF no network connection exists THEN plan checks SHALL degrade gracefully, caching entitlements and deferring remote validation without interrupting core offline functionality.\r\n\r\n## Non-Functional Requirements\r\n\r\n### Code Architecture and Modularity\r\n- Extend `analytics_service`, `recommendation_service`, and forthcoming `metering_service` as isolated Rust modules with well-defined command boundaries.\r\n- Frontend must expose new stores/hooks (`useProductivityScore`, `useRecommendations`, `useMetering`) without leaking business logic into components.\r\n- Shared typing lives in `src/types` with synchronized Zod schemas; avoid duplicating interfaces between layers.\r\n\r\n### Performance\r\n- All scoring, forecasting, and recommendation computations SHALL complete within 250 ms per request on a mid-tier laptop (Intel i5/16 GB) using cached aggregates where possible.\r\n- Daily batch jobs SHALL finish under 60 seconds and run off the UI thread to prevent blocking startup.\r\n\r\n### Security\r\n- Sensitive usage and feedback logs SHALL be encrypted at rest using the existing local key vault; no raw API keys or user notes appear in plaintext.\r\n- Any outbound telemetry for future billing integrations SHALL require explicit user opt-in and redact task content.\r\n\r\n### Reliability\r\n- Recommendation and forecasting services SHALL fail with actionable error messages and fallback states instead of app crashes; retries follow exponential back-off with jitter.\r\n- Usage counters SHALL persist across app restarts and tolerate SQLite write contention through transactional updates.\r\n\r\n### Usability\r\n- All new insights and nudges SHALL support keyboard navigation, screen reader labels, and respect the global theme.\r\n- Explanations and upgrade messaging SHALL remain concise (<140 characters) with links to detailed rationale panels when needed.\r\n",
  "fileStats": {
    "size": 9864,
    "lines": 108,
    "lastModified": "2025-10-13T00:15:46.148Z"
  },
  "comments": []
}