{
  "id": "snapshot_1760005679332_9sph7sanf",
  "approvalId": "approval_1760005679305_3gkslk1aa",
  "approvalTitle": "Phase1 intelligent task parsing tasks",
  "version": 1,
  "timestamp": "2025-10-09T10:27:59.332Z",
  "trigger": "initial",
  "status": "pending",
  "content": "# Tasks Document\r\n\r\n- [ ] 1. Extend task domain models for AI metadata\r\n  - File: src/types/task.ts\r\n  - File: src/utils/validators.ts\r\n  - Update Task and TaskPayload interfaces with AI增强字段、计划开始时间、预估工时、任务类型、标签，并同步校验与默认值，确保兼容 existing store。\r\n  - _Leverage: src/types/task.ts, src/utils/validators.ts, requirements.md_\r\n  - _Requirements: Requirement 1, Requirement 3_\r\n  - _Prompt: Implement the task for spec phase1-intelligent-task-parsing, first run spec-workflow-guide to get the workflow guide then implement the task: Role: TypeScript Domain Modeler | Task: Extend task-related TypeScript types and validators to cover AI-enhanced metadata defined in requirements while keeping backward compatibility | Restrictions: Limit changes to the listed files, do not break existing exports, preserve existing validation helpers | Success: All new fields are typed, parsed, and validated; existing unit tests compile; no TypeScript errors introduced | Instructions: Before coding set this task to [-] in tasks.md and set it to [x] once the work and reviews are complete._\r\n\r\n- [ ] 2. Add AI parse command wrappers in Tauri API layer\r\n  - File: src/services/tauriApi.ts\r\n  - File: src/utils/validators.ts\r\n  - Introduce tasks_parse_ai invoke wrapper、错误映射与 mock fallback，同时接收并返回 AI metadata。\r\n  - _Leverage: src/services/tauriApi.ts, TaskListResponse utilities, requirements.md_\r\n  - _Requirements: Requirement 1, Requirement 4_\r\n  - _Prompt: Implement the task for spec phase1-intelligent-task-parsing, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Frontend Infrastructure Engineer | Task: Add a dedicated parseTask API wrapper with proper validation, error handling, and mock behavior so the UI can request AI parsing | Restrictions: Modify only the listed files, reuse existing error mapping helpers, keep TAURI_UNAVAILABLE flow working | Success: New parseTask function exported, type-safe payload/response, unit mocks continue to operate | Instructions: Before coding set this task to [-] in tasks.md and set it to [x] after completion and verification._\r\n\r\n- [ ] 3. Enhance useTaskForm hook with AI workflow state\r\n  - File: src/hooks/useTaskForm.ts\r\n  - File: src/components/tasks/TaskFormDialog.tsx\r\n  - Manage AI解析状态、缺失字段提示、结果回填与缓存标记；协调表单与 store 提交逻辑。\r\n  - _Leverage: src/hooks/useTaskForm.ts, src/components/tasks/TaskFormDialog.tsx_\r\n  - _Requirements: Requirement 1, Requirement 2, Requirement 4_\r\n  - _Prompt: Implement the task for spec phase1-intelligent-task-parsing, first run spec-workflow-guide to get the workflow guide then implement the task: Role: React Hook Specialist | Task: Extend useTaskForm to coordinate invoking parseTask, tracking loading/error state, surfacing missing fields, and applying AI results while preserving manual overrides | Restrictions: Keep hook API backward-compatible for callers, avoid side effects outside hook scope, respect existing validation schemas | Success: Hook exposes AI state and callbacks, form dialog renders status chips/tooltips, manual edits remain intact | Instructions: Before coding set this task to [-] in tasks.md and when done revert to [x] after tests and review._\r\n\r\n- [ ] 4. Implement TaskAiParsePanel component\r\n  - File: src/components/tasks/TaskAiParsePanel.tsx\r\n  - File: src/components/tasks/TaskFormDialog.tsx\r\n  - 提供自然语言输入区、触发按钮、进度/错误反馈、应用与反馈操作，并连接 useTaskForm。\r\n  - _Leverage: shadcn/ui button/input components, ToastProvider, useTaskForm_\r\n  - _Requirements: Requirement 1, Requirement 2_\r\n  - _Prompt: Implement the task for spec phase1-intelligent-task-parsing, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Frontend Component Engineer | Task: Build the TaskAiParsePanel UI that consumes hook callbacks to trigger AI parsing, show live/cache status, and apply results into the form | Restrictions: Follow existing component styling conventions, ensure accessibility labels, do not introduce global state | Success: Panel renders within TaskFormDialog, handles loading/error states, fires callbacks correctly | Instructions: Before coding mark this task as [-] in tasks.md and set to [x] when implementation passes review._\r\n\r\n- [ ] 5. Create TaskCotViewer and integrate CoT insights\r\n  - File: src/components/tasks/TaskCotViewer.tsx\r\n  - File: src/components/tasks/TaskDetailsDrawer.tsx\r\n  - File: src/components/tasks/TaskFormDialog.tsx\r\n  - 展示思维链步骤、摘要、复制/反馈交互，并在表单与详情抽屉中挂载查看入口。\r\n  - _Leverage: Dialog, ScrollArea, Tooltip components, design.md architecture section_\r\n  - _Requirements: Requirement 2, Requirement 3_\r\n  - _Prompt: Implement the task for spec phase1-intelligent-task-parsing, first run spec-workflow-guide to get the workflow guide then implement the task: Role: UX-focused React Engineer | Task: Build a reusable CoT viewer component and embed it where users inspect AI reasoning, including copy and feedback affordances | Restrictions: Keep component self-contained, reuse shared UI primitives, avoid duplicating styles | Success: Viewer displays ordered steps and summary, accessible trigger buttons exist in form & details, feedback events bubble up | Instructions: Before coding set this task to [-] in tasks.md and when done update it to [x] after validation._\r\n\r\n- [ ] 6. Update task store and list surfaces for AI metadata\r\n  - File: src/stores/taskStore.ts\r\n  - File: src/components/tasks/TaskTable.tsx\r\n  - File: src/components/tasks/TaskDetailsDrawer.tsx\r\n  - 同步 store 状态与 UI 列表以展示复杂度、标签、缓存来源、过滤能力。\r\n  - _Leverage: Zustand patterns in taskStore, TaskTable columns, requirements.md Requirement 3_\r\n  - _Requirements: Requirement 2, Requirement 3_\r\n  - _Prompt: Implement the task for spec phase1-intelligent-task-parsing, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Frontend State Engineer | Task: Extend task store and table/detail views to persist and render AI metadata, supporting filters and badges per design | Restrictions: Maintain immutability in state updates, keep pagination intact, avoid performance regressions | Success: Store keeps new fields, UI surfaces badges/tooltips, filters operate within 200ms | Instructions: Before coding flip this task to [-] in tasks.md and return it to [x] once complete._\r\n\r\n- [ ] 7. Add tasks_parse_ai Tauri command plumbing\r\n  - File: src-tauri/src/commands/ai.rs\r\n  - File: src-tauri/src/commands/mod.rs\r\n  - File: src-tauri/src/lib.rs\r\n  - 实现新的命令入口、参数校验、错误映射，并将命令注册进 Builder。\r\n  - _Leverage: existing task commands, AppState management, design.md architecture diagram_\r\n  - _Requirements: Requirement 1, Requirement 4_\r\n  - _Prompt: Implement the task for spec phase1-intelligent-task-parsing, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Rust Tauri Command Engineer | Task: Create the tasks_parse_ai command that invokes AiService, handles AppError mapping, and registers within the command set | Restrictions: Keep command async boundaries consistent, reuse CommandResult types, avoid duplicating logging | Success: Command compiles, returns structured ParsedTaskResponse, integrated into invoke handler | Instructions: Before coding mark this task as [-] in tasks.md and set back to [x] after finishing implementation and tests._\r\n\r\n- [ ] 8. Implement AiService, CotEngine, and CacheService\r\n  - File: src-tauri/src/services/ai_service.rs\r\n  - File: src-tauri/src/services/cot_engine.rs\r\n  - File: src-tauri/src/services/cache_service.rs\r\n  - 构建 DeepSeek 调用、Prompt 生成、思维链解析、缓存命中/TTL/日志、回退策略。\r\n  - _Leverage: reqwest client utilities, tracing logger, design.md service breakdown_\r\n  - _Requirements: Requirement 1, Requirement 2, Requirement 4_\r\n  - _Prompt: Implement the task for spec phase1-intelligent-task-parsing, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Rust AI Service Developer | Task: Implement service modules that orchestrate DeepSeek requests, CoT processing, and cache lookups per design | Restrictions: Respect SRP across the three files, handle errors via AppError, ensure blocking work runs via async runtime | Success: Services compile, unit tests for core logic pass, cache hits logged with metrics | Instructions: Before coding toggle this task to [-] in tasks.md and back to [x] when done._\r\n\r\n- [ ] 9. Update database schema and repositories for new fields\r\n  - File: src-tauri/src/db/schema.sql\r\n  - File: src-tauri/src/db/migrations.rs\r\n  - File: src-tauri/src/models/task.rs\r\n  - 添加任务字段列、AI缓存表、序列化/反序列化逻辑，确保迁移幂等且启动自检。\r\n  - _Leverage: existing migration helpers, TaskRecord mapping, requirements.md Requirement 3_\r\n  - _Requirements: Requirement 3, Requirement 4_\r\n  - _Prompt: Implement the task for spec phase1-intelligent-task-parsing, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Rust Persistence Engineer | Task: Extend DB schema and repositories to store AI metadata and cache entries with proper defaults and constraints | Restrictions: Maintain backward compatibility by setting defaults, ensure migrations run once, update TaskRecord conversions | Success: Migrations succeed on fresh and existing DBs, repository returns enriched records, cache table accessible | Instructions: Before coding set this task to [-] in tasks.md and mark [x] when verified._\r\n\r\n- [ ] 10. Add logging, configuration, and tests for AI workflow\r\n  - File: src-tauri/src/utils/logger.rs\r\n  - File: src-tauri/tests/integration/ai_parse.rs\r\n  - File: src/__tests__/taskStore.test.ts\r\n  - 配置 tracing target、覆盖正向/离线/缓存回退的集成测试与前端单元测试。\r\n  - _Leverage: existing tracing setup, Vitest suites, Playwright fixtures_\r\n  - _Requirements: Requirement 2, Requirement 4, Non-Functional Requirements_\r\n  - _Prompt: Implement the task for spec phase1-intelligent-task-parsing, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Full-stack Test & Observability Engineer | Task: Instrument logging for AI flows and implement automated tests covering parsing success, failure fallback, and UI state | Restrictions: Keep test runtime reasonable, reuse existing test utilities, do not introduce flaky assertions | Success: Logs show cache hit/miss metrics, integration and unit tests pass locally and in CI | Instructions: Before coding set this task status to [-] in tasks.md and upon completion revert to [x]._\r\n",
  "fileStats": {
    "size": 10948,
    "lines": 88,
    "lastModified": "2025-10-09T10:27:27.965Z"
  },
  "comments": []
}